---
layout: post
title:  "TCP的四次挥手"
date:   2018-10-27 15:22:54
categories: 基础知识
---

No |Source         |   Destination   | Seq   | Ack  | Len  | Flag     |
-- |---------------|-----------------|-------|------|------|----------|
1  |10.0.0.66	   | 123.206.120.159 | 38601 |1094  | 0    | FIN，ACK |
2  |123.206.120.159| 10.0.0.66       | 1094  |38602 | 0    | ACK      |
3  |123.206.120.159| 10.0.0.66       | 1094  |38602 | 0    | FIN，ACK |
4  |10.0.0.66	   | 123.206.120.159 | 38602 |1095  | 0    | ACK      |

Flag.FIN代表发送方数据已经发送完毕，要断开连接

数据包1:客户端向服务器发送了FIN数据包，表示我的数据都发送完了，我们断开连接吧。客户端
的状态由ESTABLISHED进入FIN_WAIT1。

数据包2:服务器收到了客户端的FIN数据包，回复了ACK数据包。服务器在回复了ACK数据包后，由
ESTABLISHED进入CLOSE_WAIT状态。客户端在接收到ACK数据包后由FIN_WAIT1进入FIN_WAIT2
状态。

数据包3:服务器向客户端发送FIN数据包，表示我的数据包都发送完了，我们断开连接吧。服务器由
CLOSE_WAIT状态进入LAST_ACK状态。

数据包4:客户端收到了服务器的FIN数据包，回复了ACK数据包。客户端在收到服务器的FIN数据包后
会由FIN_WAIT2状态进入TIME_WAIT状态，2MSL(MSL报文最大生存时间)后进入CLOSED状态。服务
器在收到客户端的ACK数据包后会由LAST_ACK进入CLOSED状态。

接下来进入我们的提问时间，是否可以变成两次挥手或者三次挥手？也就是当一方请求断开连接的
时候，双方直接断开连接。

**不可以**。

因为在TCP连接中，双方是互相发送数据的，其中一方请求断开连接，是因为它发送完数据了，但是
这时候并不能确定另一方是否发送完数据，所以需要等另一方发送完数据，用FIN数据包告知这件事
于是双方断开连接。