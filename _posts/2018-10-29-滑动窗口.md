---
layout: post
title:  "滑动窗口"
date:   2018-10-29 15:22:54
categories: 基础知识
---

## 1.什么是滑动窗口

滑动窗口:分为发送窗口和接收窗口。

假设发送窗口大小为3字节

已发送已收到ACK | 已发送未收到ACK | 未发送可以发送 | 未发送不可以发送 | 收到ACK序号 |
--------------|--------------|--------------|--------------|--------------|
......21,22,23| 24,25        | 26           | 27,28,29.....| 收到ACK24
......23,24,25| 26           | 27,28        | 29,30,31.....| 收到ACK26

发送窗口大小指的是 "已发送未收到ACK" + "未发送但可以发送" 两部分。

接收窗口

接收方缓存内会存在三种状态:已接收，未接收但可以接收，未接收不可以接收。因为TCP协议保证了
在收到数据包的时候立刻回复ACK，所以是不存在已接受但未回复ACK状态的。

## 2.滑动窗口的目的是什么

TCP协议要求接收方确认每一个发送方发来的数据包(回ACK)，这就导致了TCP的速度远远不如UDP。我们
想一个问题，如果每发一个数据包都要等接收方回复Ack后我们才能发下一个数据包，这种情况下，我们的
网速之慢可想而知。而滑动窗口就可以解决这个问题，在发送窗口允许内，我们可以发多个数据包，而接收方
可以慢慢去处理，这样，极大的提升了我们的网速。

## 3.滑动窗口的特性

1.可靠性，只有当发送方收到Ack，发送窗口才会移动，接收方收到Seq，接收窗口才会移动。如果接收方并未收到
Seq，接收窗口不会移动，这样也就不会对超出接收窗口的数据进行处理，而发送方在等了一会后并没有收到Ack，
判定为数据包丢失，重新发送数据包。

2.流控特性，接收方可以根据应用的处理能力扩大或缩小滑动窗口，在空闲时扩大滑动窗口，在繁忙时减小滑动窗口，因此来
改变对方发送速率。保证发送速率不会超过接收速率。


## 4.滑动窗口如何计算

抓一个TCP包

> 10	0.099889	174.143.213.184	192.168.1.2	TCP	1514	80 → 54841 [ACK] Seq=2897 Ack=726 **Win=7296** Len=1448 TSval=315395197 TSecr=863200 [TCP segment of a reassembled PDU]
> Window size value: 114
> [Calculated window size: 7296]
> [Window size scaling factor: 64]

在抓的这个包中，真正的窗口大小为 [Calculated window size: 7296]，而它等于 Window size value: 114 * [Window size scaling factor: 64]，这是因为现在的带宽很大，所以为了扩大滑动窗口到大小，使用了Window size scaling factor选项。