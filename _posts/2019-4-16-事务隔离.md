---
layout: post
title:  "äº‹åŠ¡éš”ç¦»"
date:   2019-4-16 22:00:00
categories: æ•°æ®åº“
tags: æ•°æ®åº“
excerpt: mysql
mathjax: true
---

æŸ¥çœ‹äº‹åŠ¡éš”ç¦»çº§åˆ«
SELECT @@tx_isolation;

è®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«
SET tx_isolation='';

- repeatable-read
- read-uncommitted
- read-committes
- serializable

----

## Repeatable Read å¯é‡å¤è¯»

ä¸€ä¸ªäº‹åŠ¡å¯åŠ¨åï¼Œåœ¨å…¶ä»–äº‹åŠ¡å¯¹ç›¸åŒæ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå…ˆå‰çš„äº‹åŠ¡çš„å†…å®¹ä¸ä¼šæ”¹å˜ã€‚

äº‹åŠ¡A|äº‹åŠ¡B
--|---
SET tx_isolation='repeatable-read';<br>Query OK, 0 rows affected (0.00 sec)|SET tx_isolation='repeatable-read';<br>Query OK, 0 rows affected (0.00 sec)
BEGIN;<br>Query OK, 0 rows affected (0.00 sec)|BEGIN;<br>Query OK, 0 rows affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;
&ensp;|UPDATE tt SET name = 2;<br>Query OK, 1 row affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;

å¯ä»¥å‘ç°åœ¨äº‹åŠ¡Bä¸­å¯¹äº‹åŠ¡è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½†æ˜¯äº‹åŠ¡Aä¸­çš„æ•°æ®å¹¶æ²¡æœ‰å‘ç”Ÿä»»ä½•æ”¹å˜ã€‚

è¿™æ˜¯å› ä¸ºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«åœ¨äº‹åŠ¡å¯åŠ¨æ—¶è¿›è¡Œäº†**ä¸€è‡´æ€§è¯»**(snapshot),åœ¨ä¸€è‡´æ€§è¯»ä¹‹åå…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šå½±å“å½“å‰äº‹åŠ¡ã€‚

ä½†æ˜¯å¯¹äºå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œä¸€è‡´æ€§è¯»æ˜¯ä»¥**ç¬¬ä¸€æ¡SELECTè¯­å¥ä¸ºèµ·å§‹ç‚¹çš„**ã€‚

ä¸¾ä¸ªğŸŒ°

äº‹åŠ¡A|äº‹åŠ¡B
--|---
SET tx_isolation='repeatable-read';<br>Query OK, 0 rows affected (0.00 sec)|SET tx_isolation='repeatable-read';<br>Query OK, 0 rows affected (0.00 sec)
BEGIN;<br>Query OK, 0 rows affected (0.00 sec)|BEGIN;<br>Query OK, 0 rows affected (0.00 sec)
&ensp;|UPDATE tt SET name = 2;<br>Query OK, 1 row affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|2&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;

çœ‹ï¼Œè¿™ä¸ªæ—¶å€™äº‹åŠ¡Açš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚æ‰€ä»¥å¯é‡å¤è¯»çš„éš”ç¦»çº§åˆ«çš„ä¸€è‡´æ€§è¯»æ˜¯å‘ç”Ÿåœ¨ç¬¬ä¸€æ¡SELECTè¯­å¥ä¹‹åçš„ã€‚

----

## Read Uncommitted è¯»æœªæäº¤

ä¸€ä¸ªäº‹åŠ¡å¯åŠ¨åï¼Œå…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä»»ä½•ä¿®æ”¹éƒ½èƒ½åœ¨å½“å‰äº‹åŠ¡çœ‹åˆ°ã€‚

äº‹åŠ¡A|äº‹åŠ¡B
--|---
SET tx_isolation='read-uncommitted';<br>Query OK, 0 rows affected (0.00 sec)|SET tx_isolation='read-uncommitted';<br>Query OK, 0 rows affected (0.00 sec)
BEGIN;<br>Query OK, 0 rows affected (0.00 sec)|BEGIN;<br>Query OK, 0 rows affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;
&ensp;|UPDATE tt SET name = 2;<br>Query OK, 1 row affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|2&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;

----

## Read Committed è¯»æäº¤

ä¸€ä¸ªäº‹åŠ¡å¯åŠ¨åï¼Œå…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä»»ä½•ä¿®æ”¹åªæœ‰æäº¤åæ‰èƒ½åœ¨å½“å‰äº‹åŠ¡çœ‹åˆ°ã€‚

äº‹åŠ¡A|äº‹åŠ¡B
--|---
SET tx_isolation='read-committed';<br>Query OK, 0 rows affected (0.00 sec)|SET tx_isolation='read-committed';<br>Query OK, 0 rows affected (0.00 sec)
BEGIN;<br>Query OK, 0 rows affected (0.00 sec)|BEGIN;<br>Query OK, 0 rows affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;
&ensp;|UPDATE tt SET name = 2;<br>Query OK, 1 row affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;
&ensp;|COMMIT;<br>Query OK, 0 rows affected (0.01 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|2&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;

----

## Serializable ä¸²è¡ŒåŒ–

è¯»å†™çš„æ—¶å€™éƒ½ä¼šåŠ é”ï¼Œå½“è¯»å†™å†²çªæ—¶ï¼Œåä¸€ä¸ªäº‹åŠ¡éœ€è¦ç­‰å‰ä¸€ä¸ªäº‹åŠ¡ç»“æŸæ‰èƒ½æ‰§è¡Œã€‚

äº‹åŠ¡A|äº‹åŠ¡B
--|---
SET tx_isolation='serializable';<br>Query OK, 0 rows affected (0.00 sec)|SET tx_isolation='serializable';<br>Query OK, 0 rows affected (0.00 sec)
BEGIN;<br>Query OK, 0 rows affected (0.00 sec)|BEGIN;<br>Query OK, 0 rows affected (0.00 sec)
SELECT * FROM tt;<br>+----+<br>\|name\|<br>+----+<br>\|1&ensp;&ensp;&ensp;\|<br>+----+<br>1 rows in set (0.00 sec)|&ensp;
&ensp;|UPDATE tt SET name = 2;<br>ERROR 1205 (HY000): Lock wait timeout exceeded; try restarting transaction
